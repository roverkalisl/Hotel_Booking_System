{% extends "base.html" %}

{% block title %}{{ hotel.name }} - Calendar{% endblock %}

{% block head %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<style>
    .fc-event {
        cursor: pointer;
    }
    .calendar-legend {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-calendar-alt"></i> {{ hotel.name }} - Booking Calendar</h1>
    <div>
        <a href="{{ url_for('hotel_details', hotel_id=hotel.id) }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> හොටෙල් විස්තර
        </a>
        {% if is_owner %}
        <a href="{{ url_for('hotel_rooms', hotel_id=hotel.id) }}" class="btn btn-primary">
            <i class="fas fa-bed"></i> කාමර පාලනය
        </a>
        {% endif %}
    </div>
</div>

<div class="calendar-legend">
    <div class="legend-item">
        <div class="legend-color" style="background-color: #28a745;"></div>
        <span>තිබෙන කාමර</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background-color: #dc3545;"></div>
        <span>බුක් කළ කාමර</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background-color: #ffc107;"></div>
        <span>අවහිර කළ කාමර</span>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div id="calendar"></div>
    </div>
</div>

{% if is_owner %}
<div class="card mt-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0"><i class="fas fa-info-circle"></i> පරිපාලක උපදෙස්</h5>
    </div>
    <div class="card-body">
        <p>කැලන්ඩරයේ දින ක්ලික් කර කාමර තත්වය යාවත්කාලීන කරන්න:</p>
        <ul>
            <li>කාමර තිබේනම්: කොළ පාට</li>
            <li>බුක් කළ කාමර: රතු පාට</li>
            <li>අවහිර කළ කාමර: පිටි පාට</li>
        </ul>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: {{ events|tojson }},
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        {% if is_owner %}
        dateClick: function(info) {
            // For hotel owners - show room selection modal
            showRoomSelectionModal(info.dateStr);
        },
        {% endif %}
        eventClick: function(info) {
            // Show booking details
            showEventDetails(info.event);
        }
    });
    calendar.render();

    function showEventDetails(event) {
        const props = event.extendedProps;
        let message = `කාමර අංකය: ${props.room_number}\nතත්වය: ${props.status}`;
        
        if (props.booking_id) {
            message += `\nබුකින්ග් ID: ${props.booking_id}`;
        }
        
        alert(message);
    }

    {% if is_owner %}
    function showRoomSelectionModal(date) {
        // Implement room selection modal for hotel owners
        // This would open a modal to select room and update status
        alert('කාමර තත්වය යාවත්කාලීන කිරීම: ' + date);
        // In production, implement a proper modal with room selection
    }
    {% endif %}
});
</script>
{% endblock %}